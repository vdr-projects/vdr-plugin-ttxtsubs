From 73a69fc122dd744f48d1d51e1b5747c67b5822dc Mon Sep 17 00:00:00 2001
From: etobi <git@e-tobi.net>
Date: Sat, 13 Feb 2010 14:42:30 +0100
Subject: [PATCH 2/6] Added setup option to enable teletext subtitle recording

---
 MANUAL      |    3 +++
 config.c    |    3 +++
 config.h    |    1 +
 menu.c      |    1 +
 po/ca_ES.po |    3 +++
 po/cs_CZ.po |    3 +++
 po/da_DK.po |    3 +++
 po/de_DE.po |    3 +++
 po/el_GR.po |    3 +++
 po/es_ES.po |    3 +++
 po/et_EE.po |    3 +++
 po/fi_FI.po |    3 +++
 po/fr_FR.po |    3 +++
 po/hr_HR.po |    3 +++
 po/hu_HU.po |    3 +++
 po/it_IT.po |    3 +++
 po/lt_LT.po |    3 +++
 po/nl_NL.po |    3 +++
 po/nn_NO.po |    3 +++
 po/pl_PL.po |    3 +++
 po/pt_PT.po |    3 +++
 po/ro_RO.po |    3 +++
 po/ru_RU.po |    3 +++
 po/sk_SK.po |    3 +++
 po/sl_SI.po |    3 +++
 po/sv_SE.po |    3 +++
 po/tr_TR.po |    3 +++
 po/uk_UA.po |    3 +++
 po/zh_CN.po |    3 +++
 receiver.c  |    2 +-
 30 files changed, 84 insertions(+), 1 deletions(-)

diff --git a/MANUAL b/MANUAL
index 54e166e..57b687f 100644
--- a/MANUAL
+++ b/MANUAL
@@ -730,6 +730,9 @@ Version 1.6
                          background transparency. By default the values as broadcast
                          are used.
 
+  Record Teletext Subtitles = no
+                         If set to 'yes', teletext subtitles will be recorded.
+
   LNB:
 
   SLOF               = 11700  The switching frequency (in MHz) between low and
diff --git a/config.c b/config.c
index 6767b5c..4137abb 100644
--- a/config.c
+++ b/config.c
@@ -333,6 +333,7 @@ cSetup::cSetup(void)
   MarginStop = 10;
   AudioLanguages[0] = -1;
   DisplaySubtitles = 0;
+  SupportTeletext = 0;
   SubtitleLanguages[0] = -1;
   SubtitleOffset = 0;
   SubtitleFgTransparency = 0;
@@ -525,6 +526,7 @@ bool cSetup::Parse(const char *Name, const char *Value)
   else if (!strcasecmp(Name, "MarginStop"))          MarginStop         = atoi(Value);
   else if (!strcasecmp(Name, "AudioLanguages"))      return ParseLanguages(Value, AudioLanguages);
   else if (!strcasecmp(Name, "DisplaySubtitles"))    DisplaySubtitles   = atoi(Value);
+  else if (!strcasecmp(Name, "SupportTeletext"))     SupportTeletext    = atoi(Value);
   else if (!strcasecmp(Name, "SubtitleLanguages"))   return ParseLanguages(Value, SubtitleLanguages);
   else if (!strcasecmp(Name, "SubtitleOffset"))      SubtitleOffset     = atoi(Value);
   else if (!strcasecmp(Name, "SubtitleFgTransparency")) SubtitleFgTransparency = atoi(Value);
@@ -621,6 +623,7 @@ bool cSetup::Save(void)
   Store("MarginStop",         MarginStop);
   StoreLanguages("AudioLanguages", AudioLanguages);
   Store("DisplaySubtitles",   DisplaySubtitles);
+  Store("SupportTeletext",    SupportTeletext);
   StoreLanguages("SubtitleLanguages", SubtitleLanguages);
   Store("SubtitleOffset",     SubtitleOffset);
   Store("SubtitleFgTransparency", SubtitleFgTransparency);
diff --git a/config.h b/config.h
index 19f8768..c4c2bc4 100644
--- a/config.h
+++ b/config.h
@@ -235,6 +235,7 @@ public:
   int MarginStart, MarginStop;
   int AudioLanguages[I18N_MAX_LANGUAGES + 1];
   int DisplaySubtitles;
+  int SupportTeletext;
   int SubtitleLanguages[I18N_MAX_LANGUAGES + 1];
   int SubtitleOffset;
   int SubtitleFgTransparency, SubtitleBgTransparency;
diff --git a/menu.c b/menu.c
index 3978514..8831fb4 100644
--- a/menu.c
+++ b/menu.c
@@ -2797,6 +2797,7 @@ void cMenuSetupDVB::Setup(void)
      Add(new cMenuEditIntItem( tr("Setup.DVB$Subtitle foreground transparency"), &data.SubtitleFgTransparency, 0, 9));
      Add(new cMenuEditIntItem( tr("Setup.DVB$Subtitle background transparency"), &data.SubtitleBgTransparency, 0, 10));
      }
+  Add(new cMenuEditBoolItem(tr("Setup.DVB$Enable teletext support"), &data.SupportTeletext));
 
   SetCurrent(Get(current));
   Display();
diff --git a/po/ca_ES.po b/po/ca_ES.po
index 835f93d..0e973fa 100644
--- a/po/ca_ES.po
+++ b/po/ca_ES.po
@@ -944,6 +944,9 @@ msgstr "Transpar
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Transparència fons subtítols"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "Configuració de l'LNB"
 
diff --git a/po/cs_CZ.po b/po/cs_CZ.po
index e6ebdfd..bfc8085 100644
--- a/po/cs_CZ.po
+++ b/po/cs_CZ.po
@@ -943,6 +943,9 @@ msgstr "PrÅ¯hlednost pÃ­sma titulkÅ¯"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "PrÅ¯hlednost pozadÃ­ titulkÅ¯"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/da_DK.po b/po/da_DK.po
index c837986..a7c0230 100644
--- a/po/da_DK.po
+++ b/po/da_DK.po
@@ -941,6 +941,9 @@ msgstr "Undertekst forgrundsgennemsigtighed"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Undertekst baggrundsgennemsigtighed"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/de_DE.po b/po/de_DE.po
index 75dc3a6..b4f459c 100644
--- a/po/de_DE.po
+++ b/po/de_DE.po
@@ -941,6 +941,9 @@ msgstr "Untertitel-Transparenz Vordergrund"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Untertitel-Transparenz Hintergrund"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr "Videotext-Unterstützung aktivieren"
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/el_GR.po b/po/el_GR.po
index a35fa3b..46fdac5 100644
--- a/po/el_GR.po
+++ b/po/el_GR.po
@@ -941,6 +941,9 @@ msgstr ""
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr ""
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/es_ES.po b/po/es_ES.po
index 88b693e..afcf548 100644
--- a/po/es_ES.po
+++ b/po/es_ES.po
@@ -942,6 +942,9 @@ msgstr "Transparencia primer plano subt
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Transparencia fondo subtítulos"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/et_EE.po b/po/et_EE.po
index 8c8ad1f..07d92f8 100644
--- a/po/et_EE.po
+++ b/po/et_EE.po
@@ -941,6 +941,9 @@ msgstr "Subtiitri l
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Subtiitri tausta läbipaistvus"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr "Teleteksti tugi"
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/fi_FI.po b/po/fi_FI.po
index 1b06c3f..0fda001 100644
--- a/po/fi_FI.po
+++ b/po/fi_FI.po
@@ -944,6 +944,9 @@ msgstr "Tekstityksen lÃ¤pinÃ¤kyvyys"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Tekstityksen taustan lÃ¤pinÃ¤kyvyys"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr "Salli teksti-TV-tuki"
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/fr_FR.po b/po/fr_FR.po
index 68a581c..7a7d948 100644
--- a/po/fr_FR.po
+++ b/po/fr_FR.po
@@ -947,6 +947,9 @@ msgstr "Transparence de l'avant-plan"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Transparence du fond"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/hr_HR.po b/po/hr_HR.po
index 69104b4..aea74c6 100644
--- a/po/hr_HR.po
+++ b/po/hr_HR.po
@@ -943,6 +943,9 @@ msgstr "Transparentnost titla"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Transparentnost pozadine titla"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/hu_HU.po b/po/hu_HU.po
index b7cf1a7..125ffe6 100644
--- a/po/hu_HU.po
+++ b/po/hu_HU.po
@@ -944,6 +944,9 @@ msgstr "Felirat transzparenci
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Felirat hátterének transzparenciája"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/it_IT.po b/po/it_IT.po
index 24e5412..02b33bd 100644
--- a/po/it_IT.po
+++ b/po/it_IT.po
@@ -948,6 +948,9 @@ msgstr "Trasparenza sottotitoli"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Trasparenza sfondo sottotitoli"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/lt_LT.po b/po/lt_LT.po
index a8dfcb9..adbac95 100644
--- a/po/lt_LT.po
+++ b/po/lt_LT.po
@@ -941,6 +941,9 @@ msgstr "SubtitrÅ³ fonto permatomumas"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "SubtitrÅ³ fono permatomumas"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "Konverteris (LNB)"
 
diff --git a/po/nl_NL.po b/po/nl_NL.po
index 66febc5..4fa7d9f 100644
--- a/po/nl_NL.po
+++ b/po/nl_NL.po
@@ -945,6 +945,9 @@ msgstr "Transparantie voorgrond ondertiteling"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Transparantie achtergrond ondertiteling"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/nn_NO.po b/po/nn_NO.po
index a49ab6b..24e697d 100644
--- a/po/nn_NO.po
+++ b/po/nn_NO.po
@@ -942,6 +942,9 @@ msgstr ""
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr ""
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/pl_PL.po b/po/pl_PL.po
index e56f3bf..3202caf 100644
--- a/po/pl_PL.po
+++ b/po/pl_PL.po
@@ -942,6 +942,9 @@ msgstr "Prze
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Prze¼rocze podtytu³ów: T³o"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/pt_PT.po b/po/pt_PT.po
index 2eae063..39319b9 100644
--- a/po/pt_PT.po
+++ b/po/pt_PT.po
@@ -942,6 +942,9 @@ msgstr "Transpar
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Transparência de fundo das legendas"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/ro_RO.po b/po/ro_RO.po
index cd1a4d0..d4bd3db 100644
--- a/po/ro_RO.po
+++ b/po/ro_RO.po
@@ -944,6 +944,9 @@ msgstr "Transparen
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Transparenþa fundalului subtitrãrii"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/ru_RU.po b/po/ru_RU.po
index 57210f0..ac7b507 100644
--- a/po/ru_RU.po
+++ b/po/ru_RU.po
@@ -942,6 +942,9 @@ msgstr "
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "¿àÞ×àÐçÝÞáâì äÞÝÐ áãÑâØâàÞÒ"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "ºÞÝÒÕàâÕà"
 
diff --git a/po/sk_SK.po b/po/sk_SK.po
index a8faa76..e46ae57 100644
--- a/po/sk_SK.po
+++ b/po/sk_SK.po
@@ -941,6 +941,9 @@ msgstr "Prieh
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Priehµadnos» pozadia titulkov"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/sl_SI.po b/po/sl_SI.po
index 2e6667d..8cc86bd 100644
--- a/po/sl_SI.po
+++ b/po/sl_SI.po
@@ -942,6 +942,9 @@ msgstr "Transparentnost podnapisov"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Transparentnost ozadja podnapisov"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/sv_SE.po b/po/sv_SE.po
index 41b6592..99e166b 100644
--- a/po/sv_SE.po
+++ b/po/sv_SE.po
@@ -944,6 +944,9 @@ msgstr "Transparent f
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Transparent bakgrund textremsa"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/tr_TR.po b/po/tr_TR.po
index b0ad00f..2831961 100644
--- a/po/tr_TR.po
+++ b/po/tr_TR.po
@@ -941,6 +941,9 @@ msgstr "Altyaz
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "Altyazý arka þeffaflýk"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "LNB"
 
diff --git a/po/uk_UA.po b/po/uk_UA.po
index f316e29..5e7c5ea 100644
--- a/po/uk_UA.po
+++ b/po/uk_UA.po
@@ -941,6 +941,9 @@ msgstr "ÐŸÑ€Ð¾Ð·Ð¾Ñ€Ñ–ÑÑ‚ÑŒ Ð¿ÐµÑ€ÐµÐ´Ð½ÑŒÐ¾Ð³Ð¾ Ð¿Ð»Ð°Ð½Ñƒ ÑÑƒÐ±Ñ‚Ð¸Ñ‚Ñ€Ñ–Ð²"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "ÐŸÑ€Ð¾Ð·Ð¾Ñ€Ñ–ÑÑ‚ÑŒ Ð·Ð°Ð´Ð½ÑŒÐ¾Ð³Ð¾ Ð¿Ð»Ð°Ð½Ñƒ ÑÑƒÐ±Ñ‚Ð¸Ñ‚Ñ€Ñ–Ð²"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "ÐšÐ¾Ð½Ð²ÐµÑ€Ñ‚ÐµÑ€"
 
diff --git a/po/zh_CN.po b/po/zh_CN.po
index 11ccd84..49bb638 100644
--- a/po/zh_CN.po
+++ b/po/zh_CN.po
@@ -944,6 +944,9 @@ msgstr "å­—å¹•å‰æ™¯é€æ˜Žåº¦"
 msgid "Setup.DVB$Subtitle background transparency"
 msgstr "å­—å¹•èƒŒæ™¯é€æ˜Žåº¦"
 
+msgid "Setup.DVB$Enable teletext support"
+msgstr ""
+
 msgid "LNB"
 msgstr "åˆ‡æ¢å™¨è®¾ç½®"
 
diff --git a/receiver.c b/receiver.c
index 1312b9b..a5c8967 100644
--- a/receiver.c
+++ b/receiver.c
@@ -82,7 +82,7 @@ bool cReceiver::SetPids(const cChannel *Channel)
             AddPids(Channel->Apids()) &&
             AddPids(Channel->Dpids()) &&
             AddPids(Channel->Spids()) &&
-            AddPid(Channel->Tpid());
+            (!Setup.SupportTeletext || AddPid(Channel->Tpid()));
      }
 return true;
 }
-- 
1.7.5.4

